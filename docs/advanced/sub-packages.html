<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-advanced/sub-packages">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.18">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="GojiJS RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="GojiJS Atom Feed"><title data-rh="true">Sub Packages | GojiJS</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://goji.js.org//docs/advanced/sub-packages"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Sub Packages | GojiJS"><meta data-rh="true" name="description" content="Sub Packages is a common concept in most Mini Program platforms to improve load performance and code"><meta data-rh="true" property="og:description" content="Sub Packages is a common concept in most Mini Program platforms to improve load performance and code"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://goji.js.org//docs/advanced/sub-packages"><link data-rh="true" rel="alternate" href="https://goji.js.org//docs/advanced/sub-packages" hreflang="en"><link data-rh="true" rel="alternate" href="https://goji.js.org//zh/docs/advanced/sub-packages" hreflang="zh"><link data-rh="true" rel="alternate" href="https://goji.js.org//docs/advanced/sub-packages" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.538fe347.css">
<link rel="preload" href="/assets/js/runtime~main.df15aa67.js" as="script">
<link rel="preload" href="/assets/js/main.a938bc54.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_cbSD">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title">GojiJS</b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/get-started/introduction">Docs</a><a class="navbar__item navbar__link" href="/blog">Blog</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><span><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_vEe2"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg><span>English</span></span></a><ul class="dropdown__menu"><li><a href="/docs/advanced/sub-packages" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active">English</a></li><li><a href="/zh/docs/advanced/sub-packages" target="_self" rel="noopener noreferrer" class="dropdown__link">‰∏≠Êñá</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a href="https://github.com/airbnb/goji-js" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_cOdw"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_F6nl colorModeToggle_ndsa"><button class="clean-btn toggleButton_Szei toggleButtonDisabled_qp8o" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_y2PQ"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_sMpk"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper"><div class="docPage_CtYO"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_EOoS" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_RZnn"><div class="sidebar_gEXq"><nav class="menu thin-scrollbar menu_squC"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/get-started/introduction">Get Started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/guide/app">Guide</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/advanced/css">Advanced</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/advanced/css">CSS Module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/advanced/css-in-js">CSS-in-JS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/advanced/plugins">Plugins</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/advanced/testing">Testing Library</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/advanced/sub-packages">Sub Packages</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/faq">FAQ</a></li></ul></nav></div></aside><main class="docMainContainer_MzcF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_lvEh"><div class="docItemContainer_JwXb"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Esks" aria-label="breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/">üè†</a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><span class="breadcrumbs__link" itemprop="item name">Advanced</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="item name">Sub Packages</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_XbgT theme-doc-toc-mobile tocMobile_Pc5S"><button type="button" class="clean-btn tocCollapsibleButton_ZKEy">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Sub Packages</h1><p>Sub Packages is a common concept in most Mini Program platforms to improve load performance and code
structure. It can be regarded as chunk split in Web development.</p><p>Here are some useful links to their official documents.</p><ul><li><p><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/subpackages/basic.html" target="_blank" rel="noopener noreferrer">WeChat sub packages</a></p></li><li><p><a href="https://q.qq.com/wiki/develop/miniprogram/frame/basic_ability/basic_pack.html" target="_blank" rel="noopener noreferrer">QQ sub packages</a></p></li><li><p><a href="https://opendocs.alipay.com/mini/framework/subpackages" target="_blank" rel="noopener noreferrer">Alipay sub packages</a></p></li><li><p><a href="https://smartprogram.baidu.com/docs/develop/framework/subpackages/" target="_blank" rel="noopener noreferrer">Baidu sub packages</a></p></li><li><p><a href="https://microapp.bytedance.com/docs/zh-CN/mini-app/develop/framework/subpackages/introduction" target="_blank" rel="noopener noreferrer">Toutiao sub packages</a></p></li></ul><h2 class="anchor anchorWithStickyNavbar_UUsI" id="problems">Problems<a class="hash-link" href="#problems" title="Direct link to heading">‚Äã</a></h2><p>The original design of sub packages based code splitting result in several limitations. A sub
package cannot <code>require</code> any module in the main package nor other sub packages.</p><p>Developers have to place shared code in main package manually, otherwise they will get a compile
error from the Mini Program dev tool. In another hand, if a module was only required by a sub
package, developers should move it into the sub package to reduce size of main package.</p><h2 class="anchor anchorWithStickyNavbar_UUsI" id="hoist-and-nohoist">Hoist and nohoist<a class="hash-link" href="#hoist-and-nohoist" title="Direct link to heading">‚Äã</a></h2><p>In GojiJS, we use <a href="https://webpack.js.org/" target="_blank" rel="noopener noreferrer">Webpack</a> to analyze module dependencies and bundle the
code. With <a href="https://webpack.js.org/guides/code-splitting/" target="_blank" rel="noopener noreferrer">code splitting </a> we are able to import
dependents in a sub package from anywhere we want, like the main package, node_modules or even other
sub packages. GojiJS can <strong>hoist</strong> the shared code into a common chunk file ( usually
<code>_goji_commons.js</code> ) in the main package.</p><p>Here is an example that has 5 pages, one is in the main package and others are in 2 sub packages (
<code>packageA</code> and <code>packageB</code> ).</p><p><img loading="lazy" src="https://user-images.githubusercontent.com/1812118/138204963-4829b600-ac1a-4273-89ab-cf36d5cd03da.png" alt="sub packages example" class="img_AiFf"></p><p>GojiJS hoist modules to root common chunk. By doing this the dependencies can match Mini Program sub
packages&#x27; limitations.</p><p><img loading="lazy" src="https://user-images.githubusercontent.com/1812118/138205488-dddaf015-f752-4720-90ec-b216d6f7dc27.png" alt="hoist example" class="img_AiFf"></p><h3 class="anchor anchorWithStickyNavbar_UUsI" id="nohoistenable"><code>nohoist.enable</code><a class="hash-link" href="#nohoistenable" title="Direct link to heading">‚Äã</a></h3><p><code>boolean = true</code> if in production mode, otherwise <code>false</code>.</p><p>In above example, <code>redux</code> and <code>date-fns</code> are not shared code so they can be moved into sub packages
to reduce size of main package. We call that optimization <strong>nohoist</strong>.</p><p>You can change <code>nohoist.enable</code> option in <code>goji.config.js</code> to toggle this feature.</p><blockquote><p><code>nohoist.enable</code> is set to false in development mode to speed up code bundling.</p></blockquote><p><img loading="lazy" src="https://user-images.githubusercontent.com/1812118/138205001-0ea82de4-81b1-494c-9e30-f48d462611be.png" alt="nohoist.enable example" class="img_AiFf"></p><h3 class="anchor anchorWithStickyNavbar_UUsI" id="nohoistmaxpackages"><code>nohoist.maxPackages</code><a class="hash-link" href="#nohoistmaxpackages" title="Direct link to heading">‚Äã</a></h3><p><code>number = 1</code></p><p>Some modules, like <code>lodash</code> in the example, are shared only by sub packages. It is possible to
forked them into sub packages. Although the size of total packages increases, it does reduce the
size of main package.</p><p>To enable this feature, you can set <code>nohoist.maxPackages</code> to a number N above 1. A module shared
less than or equal N will be forked into <code>packageName/_goji_nohoist_[contenthash].js</code>.</p><p><img loading="lazy" src="https://user-images.githubusercontent.com/1812118/138208851-2c0c7fe3-6e55-4744-b4af-b74fca59228a.png" alt="nohoist.maxPackages example" class="img_AiFf"></p><p>Although the code are duplicated, the runtime closure is still a singleton. For more details see
<a href="#independent-packages">Independent packages</a>.</p><blockquote><p>Please note this feature may heart user lading time because more duplicated code are generated.
You should only use it if size of main package was exceeded or about to exceed.</p></blockquote><h3 class="anchor anchorWithStickyNavbar_UUsI" id="nohoisttest"><code>nohoist.test</code><a class="hash-link" href="#nohoisttest" title="Direct link to heading">‚Äã</a></h3><p><code>function (module, chunks) =&gt; boolean</code> <code>RegRex</code> <code>string</code></p><p>You can use this options to nohoist specific modules.</p><h2 class="anchor anchorWithStickyNavbar_UUsI" id="independent-packages">Independent packages<a class="hash-link" href="#independent-packages" title="Direct link to heading">‚Äã</a></h2><p>An independent package is a special case of sub packages. Only
<a href="https://developers.weixin.qq.com/miniprogram/dev/framework/subpackages/independent.html" target="_blank" rel="noopener noreferrer">WeChat</a>,
<a href="https://q.qq.com/wiki/develop/miniprogram/frame/basic_ability/basic_pack.html#%E7%8B%AC%E7%AB%8B%E5%88%86%E5%8C%85" target="_blank" rel="noopener noreferrer">QQ</a>
and <a href="https://smartprogram.baidu.com/docs/develop/framework/subpackages_independent/" target="_blank" rel="noopener noreferrer">Baidu</a> Mini
Program support this feature.</p><p>GojiJS support this feature in the similar way as nohoist.</p><p>First, GojiJS forks all deepened modules into <code>packageName/_goji_commons.js</code>, Then GojiJS generates
a new <code>packageName/_goji_runtime.js</code> to run load these code in the independent package and make sure
each module should has a consistent runtime closure.</p><p>To create an independent package you should add <code>independent: true</code> to <code>subPackages</code> in
<code>app.config.ts</code>.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/airbnb/goji-js/tree/main/packages/goji.js.org/docs/advanced/sub-packages.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_xj76" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_twTl"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/advanced/testing"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Testing Library</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/faq"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">FAQ</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_EtLs thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#problems" class="table-of-contents__link toc-highlight">Problems</a></li><li><a href="#hoist-and-nohoist" class="table-of-contents__link toc-highlight">Hoist and nohoist</a><ul><li><a href="#nohoistenable" class="table-of-contents__link toc-highlight"><code>nohoist.enable</code></a></li><li><a href="#nohoistmaxpackages" class="table-of-contents__link toc-highlight"><code>nohoist.maxPackages</code></a></li><li><a href="#nohoisttest" class="table-of-contents__link toc-highlight"><code>nohoist.test</code></a></li></ul></li><li><a href="#independent-packages" class="table-of-contents__link toc-highlight">Independent packages</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/get-started/introduction">Get Started</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/guide/app">Guide</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/advanced/css">Advanced</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/faq">FAQ</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/airbnb/goji-js/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Issues<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_cOdw"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_cOdw"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">¬© 2022 Airbnb, Inc. All rights reserved. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.df15aa67.js"></script>
<script src="/assets/js/main.a938bc54.js"></script>
</body>
</html>