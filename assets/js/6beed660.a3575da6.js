"use strict";(self.webpackChunkgoji_js_org=self.webpackChunkgoji_js_org||[]).push([[729],{2979:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>p,contentTitle:()=>o,default:()=>u,frontMatter:()=>r,metadata:()=>l,toc:()=>s});var a=t(7896),i=(t(2784),t(876));const r={sidebar_position:3},o="Plugins",l={unversionedId:"advanced/plugins",id:"advanced/plugins",title:"Plugins",description:"Some platforms like WeChat and Baidu provide a way to wrap and reuse JS code, components and pages",source:"@site/docs/advanced/plugins.md",sourceDirName:"advanced",slug:"/advanced/plugins",permalink:"/docs/advanced/plugins",editUrl:"https://github.com/airbnb/goji-js/tree/main/packages/goji.js.org/docs/advanced/plugins.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"CSS-in-JS",permalink:"/docs/advanced/css-in-js"},next:{title:"Testing Library",permalink:"/docs/advanced/testing"}},p={},s=[{value:"Import a plugin",id:"import-a-plugin",level:2},{value:"Use components",id:"use-components",level:2},{value:"Use pages",id:"use-pages",level:2},{value:"Use JS API",id:"use-js-api",level:2}],m={toc:s};function u(e){let{components:n,...t}=e;return(0,i.kt)("wrapper",(0,a.Z)({},m,t,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"plugins"},"Plugins"),(0,i.kt)("p",null,"Some platforms like WeChat and Baidu provide a way to wrap and reuse JS code, components and pages\non mini programs."),(0,i.kt)("p",null,"Before reading next sections, we advice you to learn these official documentations."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://developers.weixin.qq.com/miniprogram/dev/framework/plugin/"},"WeChat ",(0,i.kt)("inlineCode",{parentName:"a"},"plugins"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://smartprogram.baidu.com/docs/develop/framework/dynamiclib_use/"},"Baidu ",(0,i.kt)("inlineCode",{parentName:"a"},"dynamicLib")))),(0,i.kt)("p",null,"GojiJS enables the ability to import and use plugin/dynamicLib in React code."),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"For now, GojiJS doesn't support writing plugins.")),(0,i.kt)("h2",{id:"import-a-plugin"},"Import a plugin"),(0,i.kt)("p",null,"At first, you need to add some meta data in the ",(0,i.kt)("inlineCode",{parentName:"p"},"app.config.ts")," file. You can use param ",(0,i.kt)("inlineCode",{parentName:"p"},"target")," to\ndetect platform."),(0,i.kt)("p",null,"Here is an example to show how to enable different plugin in the same GojiJS app."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},"export default ({ target }: { target: GojiTarget }) => {\n  const enableLivePlayer = target === 'wechat';\n  const enableSwanSitemap = target === 'baidu';\n\n  return {\n    ...(enableLivePlayer && {\n      plugins: {\n        'live-player-plugin': {\n          version: '1.2.10',\n          provider: 'wx2b03c6e691cd7370',\n        },\n      },\n    }),\n    ...(enableSwanSitemap && {\n      dynamicLib: {\n        'swan-sitemap-lib': {\n          provider: 'swan-sitemap',\n        },\n      },\n    }),\n  };\n};\n")),(0,i.kt)("h2",{id:"use-components"},"Use components"),(0,i.kt)("p",null,"To enable plugin components, you need to make sure ",(0,i.kt)("inlineCode",{parentName:"p"},"@goji/macro")," package is installed."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"yarn add @goji/macro\n")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"@goji/macro")," exports a API called ",(0,i.kt)("inlineCode",{parentName:"p"},"registerPluginComponent")," that accepts these params."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},"function registerPluginComponent(\n  target: GojiTarget,\n  name: string,\n  path: string,\n  props: Array<string | [string, PropDesc]>,\n): React.FunctionComponent<any>;\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"target"),": On which platform this component could work. An empty component will be rendered on\nother platforms."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"name"),": The component name generated in ",(0,i.kt)("inlineCode",{parentName:"li"},"usingComponents"),", should be unique and not equal to any\nbuilt-in component, for example ",(0,i.kt)("inlineCode",{parentName:"li"},"<my-component-name>")," is valid and ",(0,i.kt)("inlineCode",{parentName:"li"},"<view>")," is invalid."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"path"),": The component path generated in ",(0,i.kt)("inlineCode",{parentName:"li"},"usingComponents"),", should start with ",(0,i.kt)("inlineCode",{parentName:"li"},"plugin://")," or\n",(0,i.kt)("inlineCode",{parentName:"li"},"dynamicLib://"),"."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"props"),": Properties should be defined manually before using. For example,\n",(0,i.kt)("inlineCode",{parentName:"li"},"props: ['a', ['b', { defaultValue: '100' }]]")," let GojiJS generate template like this\n",(0,i.kt)("inlineCode",{parentName:"li"},'<my-component-name a="{{props.a}}" b="{{props.b === undefined ? 100 : props.b}}">'),".")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"registerPluginComponent")," returns a React component that you can use as normal."),(0,i.kt)("p",null,"Here is a full example of\n",(0,i.kt)("a",{parentName:"p",href:"https://smartprogram.baidu.com/docs/develop/framework/sitemap/"},"Baidu sitemap component"),"."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},"import { registerPluginComponent } from '@goji/macro';\n\nconst SwanSitemapList = registerPluginComponent(\n  'baidu',\n  'swan-sitemap-list',\n  'dynamicLib://swan-sitemap-lib/swan-sitemap-list',\n  ['list-data', 'current-page', 'total-page', 'path'],\n);\n\nconst listData = [\n  {\n    title: 'GojiJS',\n    path: '/packageA/pages/details?id=1',\n    releaseDate: '2021-1-1 00-00-00',\n  },\n  {\n    title: 'Powered by',\n    path: '/packageA/pages/details?id=2',\n    releaseDate: '2021-1-2 00-00-00',\n  },\n  {\n    title: 'Airbnb',\n    path: '/packageA/pages/details?id=3',\n    releaseDate: '2021-1-3 00-00-00',\n  },\n];\n\nrender(\n  <SwanSitemapList\n    listData={listData}\n    currentPage={1}\n    totalPage={500}\n    path=\"/swan-sitemap/index\"\n  />,\n);\n")),(0,i.kt)("h2",{id:"use-pages"},"Use pages"),(0,i.kt)("p",null,"Use ",(0,i.kt)("inlineCode",{parentName:"p"},"wx.navigate")," API or ",(0,i.kt)("inlineCode",{parentName:"p"},"Navigator")," component to navigate to a page in plugin."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},'import { Navigator } from \'@goji/core\';\n\n<Navigator url="plugin://myPlugin/hello-page">WeChat</Navigator>;\n\n<Navigator url="dynamicLib://dynamicLibName/pages/index/index">Baidu</Navigator>;\n')),(0,i.kt)("h2",{id:"use-js-api"},"Use JS API"),(0,i.kt)("p",null,"Use ",(0,i.kt)("inlineCode",{parentName:"p"},"requirePlugin")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"requireDynamicLib")," directly."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx"},"if (process.env.GOJI_TARGET === 'wechat') {\n  const myPluginInterface = requirePlugin('myPlugin');\n  myPluginInterface.hello();\n}\nif (process.env.GOJI_TARGET === 'baidu') {\n  const lib = requireDynamicLib('myDynamicLib');\n  lib.getData();\n}\n")))}u.isMDXComponent=!0},876:(e,n,t)=>{t.d(n,{Zo:()=>m,kt:()=>d});var a=t(2784);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,a,i=function(e,n){if(null==e)return{};var t,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var p=a.createContext({}),s=function(e){var n=a.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},m=function(e){var n=s(e.components);return a.createElement(p.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},c=a.forwardRef((function(e,n){var t=e.components,i=e.mdxType,r=e.originalType,p=e.parentName,m=l(e,["components","mdxType","originalType","parentName"]),c=s(t),d=i,g=c["".concat(p,".").concat(d)]||c[d]||u[d]||r;return t?a.createElement(g,o(o({ref:n},m),{},{components:t})):a.createElement(g,o({ref:n},m))}));function d(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var r=t.length,o=new Array(r);o[0]=c;var l={};for(var p in n)hasOwnProperty.call(n,p)&&(l[p]=n[p]);l.originalType=e,l.mdxType="string"==typeof e?e:i,o[1]=l;for(var s=2;s<r;s++)o[s]=t[s];return a.createElement.apply(null,o)}return a.createElement.apply(null,t)}c.displayName="MDXCreateElement"}}]);