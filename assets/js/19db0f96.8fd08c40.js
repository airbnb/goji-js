"use strict";(self.webpackChunkgoji_js_org=self.webpackChunkgoji_js_org||[]).push([[867],{876:(e,t,n)=>{n.d(t,{Zo:()=>s,kt:()=>k});var a=n(2784);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var r=a.createContext({}),u=function(e){var t=a.useContext(r),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},s=function(e){var t=u(e.components);return a.createElement(r.Provider,{value:t},e.children)},d="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,r=e.parentName,s=p(e,["components","mdxType","originalType","parentName"]),d=u(n),m=o,k=d["".concat(r,".").concat(m)]||d[m]||c[m]||i;return n?a.createElement(k,l(l({ref:t},s),{},{components:n})):a.createElement(k,l({ref:t},s))}));function k(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,l=new Array(i);l[0]=m;var p={};for(var r in t)hasOwnProperty.call(t,r)&&(p[r]=t[r]);p.originalType=e,p[d]="string"==typeof e?e:o,l[1]=p;for(var u=2;u<i;u++)l[u]=n[u];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},473:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>r,contentTitle:()=>l,default:()=>c,frontMatter:()=>i,metadata:()=>p,toc:()=>u});var a=n(7896),o=(n(2784),n(876));const i={sidebar_position:1},l="Project Config",p={unversionedId:"advanced/config",id:"advanced/config",title:"Project Config",description:"Normally GojiJS works out of the box, but if you want to customize the build process and result, you",source:"@site/docs/advanced/config.md",sourceDirName:"advanced",slug:"/advanced/config",permalink:"/docs/advanced/config",draft:!1,editUrl:"https://github.com/airbnb/goji-js/tree/main/packages/goji.js.org/docs/advanced/config.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Cross-Platform",permalink:"/docs/guide/cross-platform"},next:{title:"CSS Module",permalink:"/docs/advanced/css"}},r={},u=[{value:"Example",id:"example",level:2},{value:"Options - bundle tooling",id:"options---bundle-tooling",level:2},{value:"<code>progress</code>",id:"progress",level:3},{value:"<code>watch</code>",id:"watch",level:3},{value:"<code>outputPath</code>",id:"outputpath",level:3},{value:"<code>parallel</code>",id:"parallel",level:3},{value:"<code>parallel.loader</code>",id:"parallelloader",level:3},{value:"<code>parallel.minimize</code>",id:"parallelminimize",level:3},{value:"<code>configureBabel</code>",id:"configurebabel",level:3},{value:"<code>configureWebpack</code>",id:"configurewebpack",level:3},{value:"Options - output optimizations",id:"options---output-optimizations",level:2},{value:"<code>nohoist</code>",id:"nohoist",level:3},{value:"<code>nohoist.enable</code>",id:"nohoistenable",level:3},{value:"<code>nohoist.maxPackages</code>",id:"nohoistmaxpackages",level:3},{value:"<code>nohoist.test</code>",id:"nohoisttest",level:3},{value:"<code>css</code>",id:"css",level:3},{value:"<code>css.unit</code>",id:"cssunit",level:3}],s={toc:u},d="wrapper";function c(e){let{components:t,...n}=e;return(0,o.kt)(d,(0,a.Z)({},s,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"project-config"},"Project Config"),(0,o.kt)("p",null,"Normally GojiJS works out of the box, but if you want to customize the build process and result, you\ncan use the ",(0,o.kt)("inlineCode",{parentName:"p"},"goji.config.js")," file."),(0,o.kt)("h2",{id:"example"},"Example"),(0,o.kt)("p",null,"An example of the configuration file looks like this:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"// `goji.config.js`\n\nmodule.exports = {\n  progress: true,\n  watch: true,\n  outputPath: path.join(__basedir, 'dist'),\n  nohoist: {\n    maxPackages: 3,\n  },\n  parallel: {\n    loader: 4,\n    minimize: 4,\n  },\n};\n")),(0,o.kt)("h2",{id:"options---bundle-tooling"},"Options - bundle tooling"),(0,o.kt)("h3",{id:"progress"},(0,o.kt)("inlineCode",{parentName:"h3"},"progress")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Type: ",(0,o.kt)("inlineCode",{parentName:"p"},"boolean | undefined"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Default: ",(0,o.kt)("inlineCode",{parentName:"p"},"true")))),(0,o.kt)("p",null,"A boolean value to enable/disable the progress output of GojiJS CLI."),(0,o.kt)("h3",{id:"watch"},(0,o.kt)("inlineCode",{parentName:"h3"},"watch")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Type: ",(0,o.kt)("inlineCode",{parentName:"p"},"boolean | undefined"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Default: ",(0,o.kt)("inlineCode",{parentName:"p"},"true")," on development mode and ",(0,o.kt)("inlineCode",{parentName:"p"},"false")," on production mode."))),(0,o.kt)("p",null,"A boolean value to enable/disable the watch mode of GojiJS CLI."),(0,o.kt)("h3",{id:"outputpath"},(0,o.kt)("inlineCode",{parentName:"h3"},"outputPath")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Type: ",(0,o.kt)("inlineCode",{parentName:"p"},"string | undefined"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Default: ",(0,o.kt)("inlineCode",{parentName:"p"},"[basedir]/dist/[target]")))),(0,o.kt)("p",null,"The output path of GojiJS CLI. The default folder structure is like this:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},".\n\u251c\u2500\u2500 dist\n\u2502\xa0\xa0 \u251c\u2500\u2500 alipay\n\u2502\xa0\xa0 \u251c\u2500\u2500 baidu\n\u2502\xa0\xa0 \u251c\u2500\u2500 qq\n\u2502\xa0\xa0 \u251c\u2500\u2500 toutiao\n\u2502\xa0\xa0 \u2514\u2500\u2500 wechat\n\u2514\u2500\u2500 src\n")),(0,o.kt)("h3",{id:"parallel"},(0,o.kt)("inlineCode",{parentName:"h3"},"parallel")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Type: ",(0,o.kt)("inlineCode",{parentName:"p"},"undefined | number | { loader?: number; minimize?: number }"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Default: ",(0,o.kt)("inlineCode",{parentName:"p"},"undefined")))),(0,o.kt)("p",null,"A number or an object to enable/disable the parallel mode of GojiJS CLI. You can use ",(0,o.kt)("inlineCode",{parentName:"p"},"number")," to\nspecify the number for overall parallel jobs. You can also use an object to specify the number for\neach parallelizable stage."),(0,o.kt)("h3",{id:"parallelloader"},(0,o.kt)("inlineCode",{parentName:"h3"},"parallel.loader")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Type: ",(0,o.kt)("inlineCode",{parentName:"p"},"number | undefined"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Default: value based on the number of CPU cores."))),(0,o.kt)("p",null,"It equals to the number ",(0,o.kt)("inlineCode",{parentName:"p"},"workers")," option of\n",(0,o.kt)("a",{parentName:"p",href:"https://webpack.js.org/loaders/thread-loader/"},"thread-loader")," plus ",(0,o.kt)("inlineCode",{parentName:"p"},"1"),"."),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"Note that too many parallel jobs may cost too much resources and even slow down performance. See\n",(0,o.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Amdahl%27s_law"},"Amdahl's law"),".")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"So we set a maximum of ",(0,o.kt)("inlineCode",{parentName:"p"},"workers")," to 3 if ",(0,o.kt)("inlineCode",{parentName:"p"},"parallel.loader")," is ",(0,o.kt)("inlineCode",{parentName:"p"},"undefined"),".")),(0,o.kt)("h3",{id:"parallelminimize"},(0,o.kt)("inlineCode",{parentName:"h3"},"parallel.minimize")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Type: ",(0,o.kt)("inlineCode",{parentName:"p"},"number | undefined"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Default: value based on the number of CPU cores."))),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"parallel")," option of\n",(0,o.kt)("a",{parentName:"p",href:"https://webpack.js.org/plugins/terser-webpack-plugin/#parallel"},"TerserWebpackPlugin"),"."),(0,o.kt)("h3",{id:"configurebabel"},(0,o.kt)("inlineCode",{parentName:"h3"},"configureBabel")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Type: ",(0,o.kt)("inlineCode",{parentName:"li"},"undefined | (config: any) => undefined"))),(0,o.kt)("p",null,"A function to configure the Babel config inside GojiJS."),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"config")," is the ",(0,o.kt)("a",{parentName:"p",href:"https://babeljs.io/docs/en/config-files"},"Babel's config object"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"module.exports = {\n  configureBabel: config => {\n    config.plugins.push('babel-plugin-xxx');\n  },\n};\n")),(0,o.kt)("h3",{id:"configurewebpack"},(0,o.kt)("inlineCode",{parentName:"h3"},"configureWebpack")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Type: ",(0,o.kt)("inlineCode",{parentName:"li"},"undefined | (config: webpack.Configuration, webpackInGoji: typeof webpack) => undefined"))),(0,o.kt)("p",null,"A function to configure the Webpack config inside GojiJS."),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"config")," parameter is the ",(0,o.kt)("a",{parentName:"p",href:"https://webpack.js.org/configuration/"},"Webpack's config object")," that\nyou can modify it directly."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"module.exports = {\n  configureWebpack: (config, webpack) => {\n    config.plugins.push(new OtherWebpackPlugin());\n  },\n};\n")),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"webpackInGoji")," parameter is the instance of Webpack. In some cases, you may want to use the\nfields/methods from it."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"module.exports = {\n  configureWebpack: (config, webpack) => {\n    config.plugins.push(\n      new webpack.DefinePlugin({\n        MY_ENV: 'hello world',\n      }),\n    );\n  },\n};\n")),(0,o.kt)("h2",{id:"options---output-optimizations"},"Options - output optimizations"),(0,o.kt)("h3",{id:"nohoist"},(0,o.kt)("inlineCode",{parentName:"h3"},"nohoist")),(0,o.kt)("p",null,"In GojiJS, we utilize ",(0,o.kt)("a",{parentName:"p",href:"https://webpack.js.org/"},"Webpack")," to analyze module dependencies and bundle\nthe code. Through ",(0,o.kt)("a",{parentName:"p",href:"https://webpack.js.org/guides/code-splitting/"},"code splitting"),", we can import\ndependencies in a\n",(0,o.kt)("a",{parentName:"p",href:"https://developers.weixin.qq.com/miniprogram/dev/framework/subpackages/basic.html"},"subpackage")," from\nvarious locations, such as the main package, ",(0,o.kt)("inlineCode",{parentName:"p"}," node_modules"),", or even other subpackages. GojiJS can\n",(0,o.kt)("strong",{parentName:"p"},"hoist")," the shared code into a common chunk file (usually ",(0,o.kt)("inlineCode",{parentName:"p"},"\\_goji_commons.js"),") in the main\npackage."),(0,o.kt)("p",null,"Here is an example with 5 pages, where one is in the main package, and the others are in two\nsubpackages (",(0,o.kt)("inlineCode",{parentName:"p"},"packageA")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"packageB"),")."),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/1812118/138204963-4829b600-ac1a-4273-89ab-cf36d5cd03da.png",alt:"sub packages example"})),(0,o.kt)("p",null,"In GojiJS, modules are hoisted to the root common chunk. This approach ensures that dependencies\nalign with the limitations of Mini Program subpackages."),(0,o.kt)("h3",{id:"nohoistenable"},(0,o.kt)("inlineCode",{parentName:"h3"},"nohoist.enable")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Type: ",(0,o.kt)("inlineCode",{parentName:"p"},"boolean | undefined"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Default: ",(0,o.kt)("inlineCode",{parentName:"p"},"true")," in production mode and ",(0,o.kt)("inlineCode",{parentName:"p"},"false")," otherwise."))),(0,o.kt)("p",null,"In the above example, ",(0,o.kt)("inlineCode",{parentName:"p"},"redux")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"date-fns")," are not considered shared code, so they can be moved\ninto subpackages to reduce the size of the main package. This optimization is referred to as\n",(0,o.kt)("strong",{parentName:"p"},"nohoist"),"."),(0,o.kt)("p",null,"To enable this feature, you can set the ",(0,o.kt)("inlineCode",{parentName:"p"},"nohoist.enable")," option to ",(0,o.kt)("inlineCode",{parentName:"p"},"true"),"."),(0,o.kt)("h3",{id:"nohoistmaxpackages"},(0,o.kt)("inlineCode",{parentName:"h3"},"nohoist.maxPackages")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Type: ",(0,o.kt)("inlineCode",{parentName:"p"},"number | undefined"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Default: ",(0,o.kt)("inlineCode",{parentName:"p"},"1")))),(0,o.kt)("p",null,"Some modules, such as ",(0,o.kt)("inlineCode",{parentName:"p"},"lodash")," in the example, are shared only by subpackages. It is possible to\nfork them into subpackages. While this increases the size of the total packages, it effectively\nreduces the size of the main package."),(0,o.kt)("p",null,"To enable this feature, you can set ",(0,o.kt)("inlineCode",{parentName:"p"},"nohoist.maxPackages")," to a number N greater than 1. A module\nshared less than or equal to N will be forked into ",(0,o.kt)("inlineCode",{parentName:"p"},"packageName/_goji_nohoist_[contenthash].js"),"."),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/1812118/138208851-2c0c7fe3-6e55-4744-b4af-b74fca59228a.png",alt:"nohoist.maxPackages example"})),(0,o.kt)("p",null,"Even though the code is duplicated, the runtime closure remains a singleton."),(0,o.kt)("p",null,"This feature also works with\n",(0,o.kt)("a",{parentName:"p",href:"https://developers.weixin.qq.com/miniprogram/dev/framework/subpackages/independent.html"},"independent packages"),"."),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"Please note that this feature may impact user loading time because more duplicated code is\ngenerated. It should only be used if the size of the main package has exceeded or is about to\nexceed the limit.")),(0,o.kt)("h3",{id:"nohoisttest"},(0,o.kt)("inlineCode",{parentName:"h3"},"nohoist.test")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Type:\n",(0,o.kt)("inlineCode",{parentName:"p"},"undefined | string | RegExp | ((module: webpack.Module, chunks: Array<webpack.Chunk>) => boolean)"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Default: ",(0,o.kt)("inlineCode",{parentName:"p"},"undefined")))),(0,o.kt)("p",null,"You can use this options to nohoist specific modules."),(0,o.kt)("h3",{id:"css"},(0,o.kt)("inlineCode",{parentName:"h3"},"css")),(0,o.kt)("p",null,"Options to configure the processing of styles."),(0,o.kt)("h3",{id:"cssunit"},(0,o.kt)("inlineCode",{parentName:"h3"},"css.unit")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Type: ",(0,o.kt)("inlineCode",{parentName:"p"},"undefined | 'keep' | 'to-px' | 'to-rpx'"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Default: ",(0,o.kt)("inlineCode",{parentName:"p"},"'to-rpx'")))),(0,o.kt)("p",null,"There is a built-in PostCSS plugin called\n",(0,o.kt)("a",{parentName:"p",href:"https://github.com/airbnb/goji-js/pull/231"},"postcss-transform-unit")," that can be used to transform\nCSS units in all files. In some cases, you may want to convert the usage of ",(0,o.kt)("inlineCode",{parentName:"p"},"px")," to ",(0,o.kt)("inlineCode",{parentName:"p"},"rpx")," or vice\nversa. You can use this option."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"keep"),": Do not transform any CSS unit.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"to-px"),": Transform ",(0,o.kt)("inlineCode",{parentName:"p"},"rpx")," to ",(0,o.kt)("inlineCode",{parentName:"p"},"px"),". ",(0,o.kt)("inlineCode",{parentName:"p"},"2rpx")," equals to ",(0,o.kt)("inlineCode",{parentName:"p"},"1px"),".")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"to-rpx"),": Transform ",(0,o.kt)("inlineCode",{parentName:"p"},"px")," to ",(0,o.kt)("inlineCode",{parentName:"p"},"rpx"),". ",(0,o.kt)("inlineCode",{parentName:"p"},"1px")," equals to ",(0,o.kt)("inlineCode",{parentName:"p"},"2rpx"),"."))),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"The default will be changed to ",(0,o.kt)("inlineCode",{parentName:"p"},"keep")," in the future.")))}c.isMDXComponent=!0}}]);